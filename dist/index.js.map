{"version":3,"file":"index.js","mappings":"mBACA,IAAIA,EAAsB,CCA1BA,EAAwB,CAACC,EAASC,KACjC,IAAI,IAAIC,KAAOD,EACXF,EAAoBI,EAAEF,EAAYC,KAASH,EAAoBI,EAAEH,EAASE,IAC5EE,OAAOC,eAAeL,EAASE,EAAK,CAAEI,YAAY,EAAMC,IAAKN,EAAWC,MCJ3EH,EAAwB,CAACS,EAAKC,IAAUL,OAAOM,UAAUC,eAAeC,KAAKJ,EAAKC,GCClFV,EAAyBC,IACH,oBAAXa,QAA0BA,OAAOC,aAC1CV,OAAOC,eAAeL,EAASa,OAAOC,YAAa,CAAEC,MAAO,WAE7DX,OAAOC,eAAeL,EAAS,aAAc,CAAEe,OAAO,M,wDC6DvD,QApDuB,CACfC,GAAI,GASJC,KAAM,SAAUC,EAAaC,EAA4BC,EAAkBC,EAAqBC,EAAmBC,QAAtF,IAAAJ,IAAAA,EAAA,GACrBK,KAAKR,IAAMQ,KAAKR,GAAGE,IAAMM,KAAKR,GAAGE,GAAKO,QAC1CD,KAAKR,GAAGE,GAAO,CAAEQ,kBAAmBP,GACpCK,KAAKG,eAAeT,EAAKC,EAAgBC,EAAQC,EAAWC,EAASC,IAEzEI,eAAgB,SAAUT,EAAaC,EAA4BC,EAAkBC,EAAqBC,EAAmBC,GAA7G,gBAAuB,IAAAJ,IAAAA,EAAA,GACnCS,QAAQC,IAAI,MAAOX,EAAKM,KAAKR,GAAGE,IACxB,IAAAQ,EAAsBF,KAAKR,GAAGE,GAAI,kBAC1CM,KAAKR,GAAGE,GAAO,IAAIY,UAAUZ,GAC7BM,KAAKR,GAAGE,GAAKa,MAAQZ,EACrBK,KAAKR,GAAGE,GAAKQ,kBAAoBA,EACjCF,KAAKR,GAAGE,GAAKE,OAAS,SAACY,GACnB,EAAKhB,GAAGE,GAAKa,MAAQ,EAAKf,GAAGE,GAAKQ,kBAClCN,EAAOY,IAEXR,KAAKR,GAAGE,GAAKe,UAAYZ,EACzBG,KAAKR,GAAGE,GAAKI,QAAU,SAACU,GACO,IAAvB,EAAKhB,GAAGE,GAAKa,MACbT,EAAQU,GAER,EAAKL,eAAeT,EAAK,EAAKF,GAAGE,GAAKa,MAAQ,EAAGX,EAAQC,EAAWC,EAASC,IAErFC,KAAKR,GAAGE,GAAKK,QAAU,SAACS,GACO,IAAvB,EAAKhB,GAAGE,GAAKa,OACbR,EAAQS,KAGpBP,MAAO,SAAUP,GACTM,KAAKR,IAAMQ,KAAKR,GAAGE,KACnBM,KAAKR,GAAGE,GAAKa,MAAQ,EACrBP,KAAKR,GAAGE,GAAKO,UAGrBS,YAAa,SAAUhB,EAAKiB,GACpBX,KAAKR,IAAMQ,KAAKR,GAAGE,IACnBM,KAAKR,GAAGE,GAAKkB,KAAKD,KC3D5B,EAA+BE,QAAQ,SCE9B,SAASC,EAAapB,EAAYa,GAC7C,IAAMQ,GAAM,IAAAC,QAAO,MACb,GAAqB,IAAAC,WAAS,GAA7BC,EAAM,KAAEC,EAAQ,KACjB,GAAwB,IAAAF,UAAS,IAAhCG,EAAO,KAAEC,EAAU,KAyB1B,OAxBA,IAAAC,YAAU,WACN,OAAO,WAAQP,EAAIQ,SAAU,KAC9B,KACH,IAAAD,YAAU,WAgBN,OAfKJ,GACD,OAAQxB,EAAKa,GAAO,SAAUiB,GACrBT,EAAIQ,SACLF,EAAWG,MAChB,SAAUA,GACJT,EAAIQ,SACLF,EAAWG,MAChB,SAAUA,GACJT,EAAIQ,SACLF,EAAWG,MAChB,SAAUA,GACJT,EAAIQ,SACLF,EAAWG,MAGhB,WAAQ,QAAS9B,MACzB,CAACwB,IAIG,CAACE,EAHK,WAAQL,EAAIQ,SAAU,EAAOJ,GAAS,IACtC,SAACX,GAAe,cAAed,EAAKc,IACnC,WAAQW,GAAS,K","sources":["webpack://multiple-websockets/webpack/bootstrap","webpack://multiple-websockets/webpack/runtime/define property getters","webpack://multiple-websockets/webpack/runtime/hasOwnProperty shorthand","webpack://multiple-websockets/webpack/runtime/make namespace object","webpack://multiple-websockets/./websocket/index.ts","webpack://multiple-websockets/external commonjs {\"commonjs\":\"react\",\"commonjs2\":\"react\",\"amd\":\"react\",\"root\":\"React\"}","webpack://multiple-websockets/./useWebsocket/index.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","interface CallBack {\r\n    (event: object): void\r\n}\r\ntype wsObj = {\r\n    [key: string]: any\r\n}\r\ninterface WsObject {\r\n    ws: wsObj,\r\n    open: (url: string, reconnectTimes: number, onopen: CallBack, onMessage: CallBack, onclose: CallBack, onerror: CallBack) => void,\r\n    startWebsocket: (url: string, reconnectTimes: number, onopen: CallBack, onMessage: CallBack, onclose: CallBack, onerror: CallBack) => void,\r\n    close: (url: string) => void,\r\n    sendMessage: (url: string,info?:string) => void,\r\n}\r\nconst WS: WsObject = (function (): WsObject {\r\n    let obj:WsObject = {\r\n        ws: {},\r\n        /**\r\n         * @param url websocket url\r\n         * @param reconnectTimes \r\n         * @param onopen \r\n         * @param onMessage \r\n         * @param onclose \r\n         * @param onerror \r\n         */\r\n        open: function (url: string, reconnectTimes: number = 1, onopen: CallBack, onMessage: CallBack, onclose: CallBack, onerror: CallBack): void {\r\n            if (this.ws && this.ws[url]) this.ws[url].close();\r\n            this.ws[url] = { maxReconnectTimes: reconnectTimes };\r\n            this.startWebsocket(url, reconnectTimes, onopen, onMessage, onclose, onerror);\r\n        },\r\n        startWebsocket: function (url: string, reconnectTimes: number = 1, onopen: CallBack, onMessage: CallBack, onclose: CallBack, onerror: CallBack) {\r\n            console.log(\"url\", url, this.ws[url])\r\n            const { maxReconnectTimes } = this.ws[url];\r\n            this.ws[url] = new WebSocket(url);\r\n            this.ws[url].times = reconnectTimes;\r\n            this.ws[url].maxReconnectTimes = maxReconnectTimes;\r\n            this.ws[url].onopen = (e: object) => {\r\n                this.ws[url].times = this.ws[url].maxReconnectTimes;\r\n                onopen(e);\r\n            };\r\n            this.ws[url].onmessage = onMessage;\r\n            this.ws[url].onclose = (e: object) => {\r\n                if (this.ws[url].times === 0)\r\n                    onclose(e)\r\n                else\r\n                    this.startWebsocket(url, this.ws[url].times - 1, onopen, onMessage, onclose, onerror);\r\n            };\r\n            this.ws[url].onerror = (e: object) => {\r\n                if (this.ws[url].times === 0)\r\n                    onerror(e)\r\n            };\r\n        },\r\n        close: function (url) {\r\n            if (this.ws && this.ws[url]) {\r\n                this.ws[url].times = 0\r\n                this.ws[url].close();\r\n            }\r\n        },\r\n        sendMessage: function (url, info?: string) {\r\n            if (this.ws && this.ws[url])\r\n                this.ws[url].send(info);\r\n        }\r\n    }\r\n    return obj;\r\n})();\r\n\r\n\r\nexport default WS;\r\n\r\n\r\n","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"react\");","import ws from \"../websocket\";\r\nimport { useEffect, useRef, useState } from \"react\";\r\nexport default function useWebsocket(url:string, times:number) {\r\n    const ref = useRef(null);\r\n    const [closed, setClose] = useState(true);\r\n    const [message, setMessage] = useState({});\r\n    useEffect(() => {\r\n        return () => { ref.current = true; }\r\n    }, [])\r\n    useEffect(() => {\r\n        if (!closed) {\r\n            ws.open(url, times, function (event) {\r\n                if (!ref.current)\r\n                    setMessage(event)\r\n            }, function (event) {\r\n                if (!ref.current)\r\n                    setMessage(event)\r\n            }, function (event) {\r\n                if (!ref.current)\r\n                    setMessage(event)\r\n            }, function (event) {\r\n                if (!ref.current)\r\n                    setMessage(event)\r\n            });\r\n        }\r\n        return () => { ws.close(url) };\r\n    }, [closed])\r\n    const open = () => { ref.current = false; setClose(false); };\r\n    const send = (e:string) => { ws.sendMessage(url, e) };\r\n    const close = () => { setClose(true); };\r\n    return [message, open, send, close];\r\n}"],"names":["__webpack_require__","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","ws","open","url","reconnectTimes","onopen","onMessage","onclose","onerror","this","close","maxReconnectTimes","startWebsocket","console","log","WebSocket","times","e","onmessage","sendMessage","info","send","require","useWebsocket","ref","useRef","useState","closed","setClose","message","setMessage","useEffect","current","event"],"sourceRoot":""}